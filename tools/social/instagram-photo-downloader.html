<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Photo Downloader - Free Online Tool</title>
    <meta name="description" content="Download high-quality photos from Instagram posts, stories, and reels. Fast, free, and no login required.">
    <link href="../../styles/main.css" rel="stylesheet">
    <link href="../../styles/tool.css" rel="stylesheet">
    <link href="../../styles/social-tools-dark.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dark-theme">
    <!-- Header Include -->
    <div include-html="../../components/header.html"></div>

    <main class="social-tool-container">
        <div class="tool-header">
            <h1><i class="fab fa-instagram"></i> Instagram Photo Downloader</h1>
            <p class="text-secondary">Download high-quality photos from Instagram posts, stories, and reels</p>
        </div>

        <div class="tool-content">
            <!-- URL Input Section -->
            <div class="tool-card">
                <div class="form-group">
                    <label for="postUrl">Instagram Post URL</label>
                    <div class="input-group">
                        <input type="text" id="postUrl" class="form-control" 
                               placeholder="https://www.instagram.com/p/...">
                        <button class="btn-primary" onclick="getPhotoInfo()">
                            <i class="fas fa-search"></i> Get Photo
                        </button>
                    </div>
                    <small class="text-secondary">Works with posts, stories, and reels</small>
                </div>

                <!-- Options Selection -->
                <div class="quality-options mt-4">
                    <h4>Download Options</h4>
                    <div id="downloadOptions">
                        <button class="quality-option active" data-option="original">Original Quality</button>
                        <button class="quality-option" data-option="compressed">Compressed</button>
                        <button class="quality-option" data-option="thumbnail">Thumbnail</button>
                    </div>
                </div>
            </div>
                                    <button type="button" class="btn btn-primary" id="fetchButton">
                                        <i class="fas fa-search"></i> Fetch Photos
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Photos Section -->
                    <div class="card mt-4" id="photosCard" style="display: none;">
                        <div class="card-body">
                            <h5 class="card-title">Available Photos</h5>
                            <div class="row" id="photosList"></div>
                        </div>
                    </div>

                    <!-- Post Information Section -->
                    <div class="card mt-4" id="postInfoCard" style="display: none;">
                        <div class="card-body">
                            <h5 class="card-title">Post Information</h5>
                            <div id="postInfo"></div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="results" style="display: none">
                        <!-- Photo Preview -->
                        <div class="tool-card">
                            <div class="media-preview">
                                <img id="photoPreview" src="" alt="Photo preview">
                                <div class="overlay">
                                    <h3 id="postTitle" class="text-white mb-2">-</h3>
                                    <p id="postStats" class="text-white-50">-</p>
                                </div>
                            </div>

                            <!-- Photo Information -->
                            <div class="metadata-grid">
                                <div class="metadata-item">
                                    <span class="metadata-label">Resolution</span>
                                    <span class="metadata-value" id="photoResolution">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Size</span>
                                    <span class="metadata-value" id="photoSize">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Type</span>
                                    <span class="metadata-value" id="photoType">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Posted</span>
                                    <span class="metadata-value" id="postDate">-</span>
                                </div>
                            </div>

                            <!-- Download Buttons -->
                            <div class="text-center mt-4">
                                <button class="btn-primary btn-lg" onclick="downloadPhoto()">
                                    <i class="fas fa-download"></i> Download Now
                                </button>
                                <button class="btn-outline ms-2" onclick="copyPhotoUrl()">
                                    <i class="fas fa-link"></i> Copy URL
                                </button>
                            </div>
                        </div>

                        <!-- Additional Photos (for carousel posts) -->
                        <div id="additionalPhotos" class="tool-card" style="display: none">
                            <h3>Additional Photos</h3>
                            <p class="text-secondary">This post contains multiple photos. Click to preview and download.</p>
                            <div class="photo-grid" id="photoGrid"></div>
                        </div>
                    </div>

                    <!-- History Section -->
                    <div class="card mt-4">
                        <div class="card-body">
                            <h5 class="card-title">Recent Downloads</h5>
                            <div id="history" class="text-center text-muted">
                                No photos downloaded yet
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <!-- Ad Space -->
                    <div class="ad-space mb-4">
                        <p class="text-muted">Advertisement Space</p>
                    </div>

                    <!-- Information Card -->
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">About Instagram Photo Downloader</h5>
                            <p class="card-text">
                                Download high-quality photos from any Instagram post.
                                Supports single photos and carousel posts.
                            </p>
                            <h6>Features:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success"></i> High-quality downloads</li>
                                <li><i class="fas fa-check text-success"></i> Carousel support</li>
                                <li><i class="fas fa-check text-success"></i> Post information</li>
                                <li><i class="fas fa-check text-success"></i> Download history</li>
                                <li><i class="fas fa-check text-success"></i> Easy to use</li>
                            </ul>
                            <div class="alert alert-info mt-3">
                                <i class="fas fa-info-circle"></i>
                                <small>Tip: Make sure the Instagram post is public and accessible.</small>
                            </div>
                        </div>
                    </div>

                    <!-- How to Download Card -->
                    <div class="card mt-4">
                        <div class="card-body">
                            <h5 class="card-title">How to Download Instagram Photos</h5>
                            <div class="feature-list mt-3">
                                <div class="feature-item">
                                    <i class="fas fa-link text-primary"></i>
                                    <div>
                                        <h4>Copy Post URL</h4>
                                        <p class="text-secondary">Click the three dots (â‹®) on any Instagram post and select "Copy Link"</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-paste text-primary"></i>
                                    <div>
                                        <h4>Paste URL Above</h4>
                                        <p class="text-secondary">Paste the copied URL into the input field and click "Get Photo"</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-image text-primary"></i>
                                    <div>
                                        <h4>Preview Photo</h4>
                                        <p class="text-secondary">Check the photo quality and choose your preferred download option</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <i class="fas fa-download text-primary"></i>
                                    <div>
                                        <h4>Download Photo</h4>
                                        <p class="text-secondary">Click the download button to save the photo to your device</p>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-info mt-4">
                                <i class="fas fa-lightbulb"></i>
                                Pro Tip: For carousel posts (multiple photos), all images will be available for download after fetching the post.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Include -->
    <div include-html="../../components/footer.html"></div>

    <!-- Scripts -->
    <script src="../../js/main.js"></script>
    <script src="../../js/social-tools.js"></script>
    <script>
        let currentPostId = '';
        let currentMetadata = null;
        let currentOption = 'original';
        let currentPhotos = [];

        async function getPhotoInfo() {
            const urlInput = document.getElementById('postUrl');
            const url = urlInput.value.trim();

            if (!socialTools.videoInfo.validateUrl(url, 'instagram')) {
                socialTools.showToast('Please enter a valid Instagram post URL', 'error');
                return;
            }

            try {
                // Show loading state
                document.getElementById('results').style.display = 'none';
                document.getElementById('additionalPhotos').style.display = 'none';
                socialTools.showToast('Fetching post information...', 'info');

                // Extract post ID and get metadata
                currentPostId = socialTools.videoInfo.extractVideoId(url, 'instagram');
                if (!currentPostId) throw new Error('Could not extract post ID');

                // Mock metadata - would need actual Instagram API integration
                currentMetadata = {
                    title: "Instagram Post",
                    preview: "https://via.placeholder.com/1080x1080",
                    posted: new Date().toLocaleDateString(),
                    photos: [
                        {
                            url: "https://via.placeholder.com/1080x1080",
                            resolution: "1080x1080",
                            size: "2.4 MB",
                            type: "JPG"
                        }
                    ]
                };

                currentPhotos = currentMetadata.photos;

                // Update UI
                updatePhotoInfo();
                document.getElementById('results').style.display = 'block';

                // Show additional photos if it's a carousel
                if (currentPhotos.length > 1) {
                    updatePhotoGrid();
                    document.getElementById('additionalPhotos').style.display = 'block';
                }

                socialTools.showToast('Post information loaded!', 'success');
            } catch (err) {
                socialTools.showToast('Failed to fetch post: ' + err.message, 'error');
            }
        }

        function updatePhotoInfo() {
            if (!currentMetadata || !currentPhotos.length) return;

            const photo = currentPhotos[0];

            // Update preview and info
            document.getElementById('photoPreview').src = photo.url;
            document.getElementById('postTitle').textContent = currentMetadata.title;
            document.getElementById('postStats').textContent = `Posted: ${currentMetadata.posted}`;

            // Update metadata
            document.getElementById('photoResolution').textContent = photo.resolution;
            document.getElementById('photoSize').textContent = photo.size;
            document.getElementById('photoType').textContent = photo.type;
            document.getElementById('postDate').textContent = currentMetadata.posted;
        }

        function updatePhotoGrid() {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';

            currentPhotos.forEach((photo, index) => {
                const photoEl = document.createElement('div');
                photoEl.className = 'photo-grid-item';
                photoEl.innerHTML = `
                    <img src="${photo.url}" alt="Photo ${index + 1}">
                    <div class="photo-grid-overlay">
                        <button class="btn-outline" onclick="downloadPhoto(${index})">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                `;
                grid.appendChild(photoEl);
            });
        }

        async function downloadPhoto(index = 0) {
            if (!currentPostId || !currentPhotos[index]) {
                socialTools.showToast('Please fetch post information first', 'error');
                return;
            }

            try {
                socialTools.showToast('Starting download...', 'info');
                // This would need actual download implementation
                await new Promise(resolve => setTimeout(resolve, 1500));
                socialTools.showToast('Download started!', 'success');
            } catch (err) {
                socialTools.showToast('Download failed: ' + err.message, 'error');
            }
        }

        async function copyPhotoUrl() {
            if (!currentPhotos.length) {
                socialTools.showToast('Please fetch post information first', 'error');
                return;
            }

            await socialTools.copyToClipboard(currentPhotos[0].url);
        }

        // Handle option selection
        document.getElementById('downloadOptions').addEventListener('click', (e) => {
            if (!e.target.classList.contains('quality-option')) return;
            
            // Update active state
            document.querySelectorAll('.quality-option').forEach(btn => 
                btn.classList.remove('active'));
            e.target.classList.add('active');
            
            // Update option
            currentOption = e.target.dataset.option;
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            includeHTML();
        });
    </script>
</body>
</html>