<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Video Downloader - Free Online Tool</title>
    <meta name="description" content="Download TikTok videos without watermark in HD quality. Support for all video types including trends, effects, and sounds.">
    <link href="../../styles/main.css" rel="stylesheet">
    <link href="../../styles/tool.css" rel="stylesheet">
    <link href="../../styles/social-tools-dark.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dark-theme">
    <!-- Header Include -->
    <div include-html="../../components/header.html"></div>

    <main class="social-tool-container">
        <div class="tool-header">
            <h1><i class="fab fa-tiktok"></i> TikTok Video Downloader</h1>
            <p class="text-secondary">Download TikTok videos in HD quality without watermark</p>
        </div>

        <div class="tool-content">
            <!-- URL Input Section -->
            <div class="tool-card">
                <div class="form-group">
                    <label for="videoUrl">TikTok Video URL</label>
                    <div class="input-group">
                        <input type="text" id="videoUrl" class="form-control" 
                               placeholder="https://www.tiktok.com/@username/video/...">
                        <button class="btn-primary" onclick="getVideoInfo()">
                            <i class="fas fa-search"></i> Get Video
                        </button>
                    </div>
                    <small class="text-secondary">Works with all TikTok videos including trends, effects, and sounds</small>
                </div>

                <!-- Download Options -->
                <div class="quality-options mt-4">
                    <h4>Download Options</h4>
                    <div id="downloadOptions">
                        <button class="quality-option active" data-option="hd">HD - No Watermark</button>
                        <button class="quality-option" data-option="sd">SD - No Watermark</button>
                        <button class="quality-option" data-option="audio">Audio Only</button>
                        <button class="quality-option" data-option="original">Original with Watermark</button>
                    </div>
                </div>
            </div>
                                    <button type="button" class="btn btn-primary" id="fetchButton">
                                        <i class="fas fa-search"></i> Fetch Video
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Video Section -->
                    <div class="card mt-4" id="videoCard" style="display: none;">
                        <div class="card-body">
                            <h5 class="card-title">Available Video</h5>
                            <div id="videoContainer"></div>
                        </div>
                    </div>

                    <!-- Video Information Section -->
                    <div class="card mt-4" id="videoInfoCard" style="display: none;">
                        <div class="card-body">
                            <h5 class="card-title">Video Information</h5>
                            <div id="videoInfo"></div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div id="results" style="display: none">
                        <!-- Video Preview -->
                        <div class="tool-card">
                            <div class="media-preview">
                                <img id="videoThumbnail" src="" alt="Video thumbnail">
                                <div class="overlay">
                                    <h3 id="videoTitle" class="text-white mb-2">-</h3>
                                    <p id="videoStats" class="text-white-50">-</p>
                                </div>
                            </div>

                            <!-- Video Information -->
                            <div class="metadata-grid">
                                <div class="metadata-item">
                                    <span class="metadata-label">Creator</span>
                                    <span class="metadata-value" id="videoCreator">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Duration</span>
                                    <span class="metadata-value" id="videoDuration">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Views</span>
                                    <span class="metadata-value" id="videoViews">-</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="metadata-label">Likes</span>
                                    <span class="metadata-value" id="videoLikes">-</span>
                                </div>
                            </div>

                            <!-- Download Button -->
                            <div class="text-center mt-4">
                                <button class="btn-primary btn-lg" onclick="downloadVideo()">
                                    <i class="fas fa-download"></i> Download Now
                                </button>
                                <button class="btn-outline ms-2" onclick="copyVideoUrl()">
                                    <i class="fas fa-music"></i> Extract Audio
                                </button>
                            </div>
                        </div>

                        <!-- Video Details -->
                        <div class="tool-card">
                            <h3>Video Details</h3>
                            <div class="tag-list mt-3" id="hashtagList">
                                <!-- Hashtags will be populated here -->
                            </div>
                            <p class="text-secondary mt-3" id="videoDescription"></p>
                            
                            <!-- Sound Information -->
                            <div class="feature-item mt-4">
                                <i class="fas fa-music text-primary"></i>
                                <div>
                                    <h4 id="soundTitle">Original Sound</h4>
                                    <p class="text-secondary" id="soundCreator">-</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Information Card -->
                    <div class="tool-card">
                        <h3>How to Download TikTok Videos</h3>
                        <div class="feature-list mt-3">
                            <div class="feature-item">
                                <i class="fas fa-share text-primary"></i>
                                <div>
                                    <h4>Share the Video</h4>
                                    <p class="text-secondary">Tap "Share" on any TikTok video and choose "Copy Link"</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-paste text-primary"></i>
                                <div>
                                    <h4>Paste URL Above</h4>
                                    <p class="text-secondary">Paste the copied URL into the input field and click "Get Video"</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-video text-primary"></i>
                                <div>
                                    <h4>Choose Quality</h4>
                                    <p class="text-secondary">Select your preferred download option (HD, SD, or Audio)</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-download text-primary"></i>
                                <div>
                                    <h4>Download Video</h4>
                                    <p class="text-secondary">Click the download button to save the video to your device</p>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info mt-4">
                            <i class="fas fa-lightbulb"></i>
                            Pro Tip: Download without watermark using HD or SD options. For music/sounds, use the audio-only option.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Include -->
    <div include-html="../../components/footer.html"></div>

    <!-- Scripts -->
    <script src="../../js/main.js"></script>
    <script src="../../js/social-tools.js"></script>
    <script>
        let currentVideoId = '';
        let currentMetadata = null;
        let currentOption = 'hd';

        async function getVideoInfo() {
            const urlInput = document.getElementById('videoUrl');
            const url = urlInput.value.trim();

            if (!socialTools.videoInfo.validateUrl(url, 'tiktok')) {
                socialTools.showToast('Please enter a valid TikTok video URL', 'error');
                return;
            }

            try {
                // Show loading state
                document.getElementById('results').style.display = 'none';
                socialTools.showToast('Fetching video information...', 'info');

                // Extract video ID and get metadata
                currentVideoId = socialTools.videoInfo.extractVideoId(url, 'tiktok');
                if (!currentVideoId) throw new Error('Could not extract video ID');

                // Mock metadata - would need actual TikTok API integration
                currentMetadata = {
                    title: "TikTok Video",
                    thumbnail: "https://via.placeholder.com/540x960",
                    creator: "@username",
                    duration: "00:30",
                    views: "1.2M",
                    likes: "50K",
                    description: "Check out this amazing video! 🎵 #trending #viral",
                    hashtags: ["trending", "viral", "fyp", "foryou"],
                    sound: {
                        title: "Original Sound",
                        creator: "@username"
                    }
                };

                // Update UI
                updateVideoInfo();
                document.getElementById('results').style.display = 'block';
                socialTools.showToast('Video information loaded!', 'success');
            } catch (err) {
                socialTools.showToast('Failed to fetch video: ' + err.message, 'error');
            }
        }

        function updateVideoInfo() {
            if (!currentMetadata) return;

            // Update preview and basic info
            document.getElementById('videoThumbnail').src = currentMetadata.thumbnail;
            document.getElementById('videoTitle').textContent = currentMetadata.title;
            document.getElementById('videoStats').textContent = `${currentMetadata.views} views`;

            // Update metadata
            document.getElementById('videoCreator').textContent = currentMetadata.creator;
            document.getElementById('videoDuration').textContent = currentMetadata.duration;
            document.getElementById('videoViews').textContent = currentMetadata.views;
            document.getElementById('videoLikes').textContent = currentMetadata.likes;

            // Update description and hashtags
            document.getElementById('videoDescription').textContent = currentMetadata.description;
            
            const hashtagList = document.getElementById('hashtagList');
            hashtagList.innerHTML = currentMetadata.hashtags.map(tag => 
                `<div class="tag-item">#${tag}</div>`).join('');

            // Update sound info
            document.getElementById('soundTitle').textContent = currentMetadata.sound.title;
            document.getElementById('soundCreator').textContent = currentMetadata.sound.creator;
        }

        async function downloadVideo() {
            if (!currentVideoId) {
                socialTools.showToast('Please fetch video information first', 'error');
                return;
            }

            try {
                socialTools.showToast('Starting download...', 'info');
                // This would need actual download implementation
                await new Promise(resolve => setTimeout(resolve, 1500));
                socialTools.showToast('Download started!', 'success');
            } catch (err) {
                socialTools.showToast('Download failed: ' + err.message, 'error');
            }
        }

        async function copyVideoUrl() {
            if (!currentVideoId) {
                socialTools.showToast('Please fetch video information first', 'error');
                return;
            }

            await socialTools.copyToClipboard(`https://www.tiktok.com/video/${currentVideoId}`);
        }

        // Handle option selection
        document.getElementById('downloadOptions').addEventListener('click', (e) => {
            if (!e.target.classList.contains('quality-option')) return;
            
            // Update active state
            document.querySelectorAll('.quality-option').forEach(btn => 
                btn.classList.remove('active'));
            e.target.classList.add('active');
            
            // Update option
            currentOption = e.target.dataset.option;
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            includeHTML();
        });
    </script>
</body>
</html>